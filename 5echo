#!/bin/bash
set -e

# ============================================
#  5echo CLI - Tools by 5echo.io
#  Version: 1.1.1
#  https://5echo.io
# ============================================

# Colors
GREEN="\e[32m"
YELLOW="\e[33m"
BLUE="\e[34m"
RED="\e[31m"
NC="\e[0m" # Reset

REPO_BASE="https://raw.githubusercontent.com/5echo-io/scripts/main"
CLI_PATH="/usr/local/bin/5echo"
CLI_URL="$REPO_BASE/5echo"

# Banner
banner() {
    echo -e "${BLUE}üõ†Ô∏è  5echo CLI - Tools by 5echo.io${NC}"
}

# Spinner
loading() {
    local message="$1"
    shift
    echo -ne "${BLUE}${message}${NC}"
    local spin='|/-\\'
    local i=0

    ("$@" >/dev/null 2>&1) &
    local pid=$!

    while kill -0 $pid 2>/dev/null; do
        printf "\r${BLUE}${message}${NC} ${spin:$i:1}"
        i=$(( (i + 1) % 4 ))
        sleep 0.2
    done

    wait $pid
    local exit_code=$?

    if [ $exit_code -eq 0 ]; then
        printf "\r${GREEN}${message}... Done!${NC}\n"
    else
        printf "\r${RED}${message}... Failed!${NC}\n"
        exit 1
    fi
}

# Show help
show_help() {
    banner
    echo -e "\nUsage:"
    echo "  5echo install <package>    Install a supported package"
    echo "  5echo update               Update this CLI to latest version"
    echo "  5echo help                 Show this help text"
    echo ""
    echo "Supported packages:"
    echo "  docker         Install Docker CE"
    echo "  uptime-kuma    Install Uptime Kuma monitoring"
    echo ""
    echo -e "${YELLOW}Powered by 5echo.io${NC}"
    echo -e "${BLUE}2025 ¬© 5echo.io${NC}"
}

# Install packages
install_package() {
    case "$1" in
        docker)
            echo -e "${YELLOW}üîß Installing Docker...${NC}"
            curl -sL "$REPO_BASE/install-docker.sh" | bash
            ;;
        uptime-kuma)
            echo -e "${YELLOW}üîß Installing Uptime Kuma...${NC}"
            curl -sL "$REPO_BASE/install-uptime-kuma.sh" | bash
            ;;
        *)
            echo -e "${RED}‚ùå Unknown package: $1${NC}"
            show_help
            ;;
    esac
}

# CLI updater
update_cli() {
    banner
    echo -e "${YELLOW}üì¶ Updating 5echo CLI...${NC}"
    sudo curl -sL "$CLI_URL" -o "$CLI_PATH"
    sudo chmod +x "$CLI_PATH"
    echo -e "${GREEN}‚úÖ CLI updated! Try: 5echo help${NC}"
}

# === Main logic ===
case "$1" in
    install)
        install_package "$2"
        ;;
    update)
        update_cli
        ;;
    help|--help|-h|"")
        show_help
        ;;
    *)
        echo -e "${RED}‚ùå Unknown command: $1${NC}"
        show_help
        ;;
esac
